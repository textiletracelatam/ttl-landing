---
import { getEntry, getCollection } from "astro:content";
import { readFileSync, existsSync } from "node:fs";

const { heading, subheading } = (await getEntry("nosotrosTeam", "team"))!.data;

const teamEntries = await getCollection("team");
const team = teamEntries.sort((a, b) => a.data.order - b.data.order);

function getIconSvg(icon: string): string {
  const path = `public/icons/socials/${icon}.svg`;
  return existsSync(path) ? readFileSync(path, "utf-8") : "";
}
---

<div class="bg-white py-24 md:py-32 dark:bg-neutral-900">
  <div class="mx-auto grid max-w-7xl grid-cols-1 gap-20 px-6 lg:px-8 xl:grid-cols-5">
    <div class="max-w-2xl xl:col-span-2">
      <h2 class="text-4xl font-semibold tracking-tight text-pretty text-neutral-900 sm:text-5xl dark:text-white">{heading}</h2>
      <p class="mt-6 text-lg/8 text-neutral-600 dark:text-neutral-400">{subheading}</p>
    </div>
    <ul role="list" class="divide-y divide-neutral-200 xl:col-span-3 dark:divide-neutral-800">
      {team.map((member) => (
        <li class="flex flex-col gap-10 py-12 first:pt-0 last:pb-0 sm:flex-row">
          <img src={member.data.image} alt="" class:list={["aspect-4/5 w-52 flex-none rounded-2xl object-cover outline-1 -outline-offset-1 outline-black/5 dark:outline-white/10", member.data.imageDark && "dark:hidden"]} />
          {member.data.imageDark && <img src={member.data.imageDark} alt="" class="hidden aspect-4/5 w-52 flex-none rounded-2xl object-cover outline-1 -outline-offset-1 outline-white/10 dark:block" />}
          <div class="max-w-xl flex-auto">
            <h3 class="text-lg/8 font-semibold tracking-tight text-neutral-900 dark:text-white">{member.data.name}</h3>
            <p class="text-base/7 text-neutral-600 dark:text-neutral-400">{member.data.role}</p>
            {member.data.bio && (
              <p class="mt-6 text-base/7 text-neutral-600 dark:text-neutral-400">{member.data.bio}</p>
            )}
            {member.data.links && member.data.links.length > 0 && (
              <ul role="list" class="mt-6 flex gap-x-6">
                {member.data.links.map((link) => (
                  <li>
                    <a
                      href={link.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-neutral-400 hover:text-neutral-500 dark:text-neutral-400 dark:hover:text-neutral-300 [&>svg]:size-5"
                    >
                      <span class="sr-only">{link.icon}</span>
                      <Fragment set:html={getIconSvg(link.icon)} />
                    </a>
                  </li>
                ))}
              </ul>
            )}
          </div>
        </li>
      ))}
    </ul>
  </div>
</div>
