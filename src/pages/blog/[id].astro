---
import Layout from "../../layouts/Layout.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { id: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<Layout title={post.data.title}>
  <article class="bg-background pt-8 pb-24 sm:pt-12 sm:pb-32">
    <div class="mx-auto max-w-4xl px-6 lg:px-8">
      <!-- Header -->
      <div class="mx-auto max-w-3xl text-center">
        <div class="flex items-center justify-center gap-x-4 text-sm">
          <time datetime={post.data.date.toISOString()} class="text-neutral-500 dark:text-neutral-400">
            {post.data.date.toLocaleDateString("es-ES", { year: "numeric", month: "long", day: "numeric" })}
          </time>
          <span class="rounded-full bg-primary-50 px-3 py-1 font-medium text-primary-700 dark:bg-primary-500/10 dark:text-primary-400">
            {post.data.category}
          </span>
        </div>
        <h1 class="mt-6 text-4xl font-semibold tracking-tight text-pretty text-neutral-900 sm:text-5xl dark:text-white">{post.data.title}</h1>
        <p class="mt-4 text-lg/8 text-neutral-600 dark:text-neutral-400">{post.data.description}</p>
        <p class="mt-4 text-sm font-semibold text-neutral-900 dark:text-white">{post.data.author}</p>
      </div>

      <!-- Featured image -->
      <div class="mt-12 overflow-hidden rounded-2xl">
        <img src={post.data.image} alt={post.data.title} class:list={["w-full object-cover", post.data.imageDark && "dark:hidden"]} />
        {post.data.imageDark && <img src={post.data.imageDark} alt={post.data.title} class="hidden w-full object-cover dark:block" />}
      </div>

      <!-- Content -->
      <div class="prose prose-lg mx-auto mt-12 max-w-3xl text-justify dark:prose-invert prose-headings:text-neutral-900 dark:prose-headings:text-white prose-p:text-neutral-600 dark:prose-p:text-neutral-400 prose-a:text-primary-600 dark:prose-a:text-primary-400">
        <Content />
      </div>

      <!-- CTA -->
      {post.data.ctaTitle && post.data.ctaMessage && post.data.ctaLink && (
        <div class="mx-auto mt-16 max-w-3xl rounded-2xl bg-primary-50 px-8 py-12 text-center dark:bg-primary-500/10">
          <h2 class="text-2xl font-semibold tracking-tight text-neutral-900 sm:text-3xl dark:text-white">{post.data.ctaTitle}</h2>
          <p class="mx-auto mt-4 max-w-xl text-base/7 text-neutral-600 dark:text-neutral-400">{post.data.ctaMessage}</p>
          <div class="mt-8">
            <a href={post.data.ctaLink} class="rounded-md bg-primary-600 px-5 py-3 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 transition-colors focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600">{post.data.ctaButtonText}</a>
          </div>
        </div>
      )}

      <!-- Back link -->
      <div class="mt-12 text-center">
        <a href="/blog" class="text-sm/6 font-semibold text-primary-600 dark:text-primary-400">&larr; Volver al blog</a>
      </div>
    </div>
  </article>
</Layout>
